import{J as e}from"./justvalidation.js";import"./otp.js";const t=document.getElementById("srNotificationArea"),a=document.getElementById("verifyMobileNumber"),i=document.getElementById("mobileForm"),n=document.getElementById("txtMobile"),s=document.getElementById("divOtp"),l=document.getElementById("adahiModal");document.querySelectorAll(".steps");const d=document.querySelector(".deleteAll"),r=document.querySelectorAll(".prodQuantity"),o=document.getElementById("adahiTypesWrapper"),c=o.dataset.userid,u=document.getElementById("adahiModalBtn"),m=document.querySelectorAll(".type-amount"),y=document.querySelectorAll(".modal-inputs"),h=document.getElementById("validateOtp"),b=document.getElementById("completePayment");document.getElementById("step1Li");const f=document.querySelector(".adahiQuantity"),p=document.getElementById("completePayment"),q=document.getElementById("adahiModalCloseBtn");let v,E=o.dataset.step,g=document.querySelectorAll(".increase-adahi"),S=document.querySelectorAll(".decrease-adahi"),x=document.querySelector(".adahiAmount"),A=document.getElementById("summary"),I={adahiRequestDetails:[],mobile:null,userId:c};if(i){let t=function(){v.addField("#txtMobile",[{rule:"required",errorMessage:"الحقل مطلوب"},{rule:"customRegexp",value:"^(05[0-9]{8})$",errorMessage:"صيغة رقم الجوال غير صحيحة"}])};v=new e("#mobileForm",{validateBeforeSubmitting:!0}),t()}null==a||a.addEventListener("click",(function(e){if(v.validate(),I.adahiRequestDetails.filter((e=>0!=e.Quantity)).length>0&&v.isValid){e.preventDefault(),a.disabled=!0;let t=n.value;fetch("Adahi/SendOtp/"+t,{method:"POST",headers:{"Content-Type":"application/json"},async:!1}).then((function(e){return e.json()})).then((function(e){if(e.isSuccess){I.Mobile=t;document.getElementById("mobile-number").innerHTML=t,s.classList.remove("d-none"),E=2,l.setAttribute("aria-label","رمز التحقق"),l.setAttribute("aria-describedby","otp-tip-description"),document.getElementById("code1").focus(),i.classList.add("d-none"),document.getElementById("stepsBar")&&(document.getElementById("step1Li").setAttribute("aria-current","false"),document.getElementById("step2Li").classList.add("active"),document.getElementById("step2Li").setAttribute("aria-current","step"))}else{var a=e.result;null==e.result&&(a="حدث خطأ أثناء إرسال الرسالة"),alert(a)}})).catch((function(e){alert("حدث خطأ أثناء إرسال الرسالة")}))}}));const L=function(e){let t=0;return e.forEach((e=>{t+=e.Quantity*e.Price})),t>0?document.querySelector("#total-amount").classList.add("text-primary-7"):document.querySelector("#total-amount").classList.remove("text-primary-7"),Number(t)>0?(u.disabled=!1,d.disabled=!1):(u.disabled=!0,d.disabled=!0),t};function B(e){let t=0;return e.forEach((e=>{t+=e.Quantity})),t}function R(e){let t=document.querySelectorAll(".accordion-adahi"),a="";return t.forEach((e=>{let t=0;e.querySelectorAll(".list-of-adahi").forEach((e=>{e.querySelectorAll(".prodQuantity").forEach((e=>{t=Number(t)+Number(e.value)}))})),t&&(a+=`<div class="p-2 d-flex flex-column px-3">\n                                 <label class="fs-12px font-ehsan-regular">نوع النسك: <span class="ps-1">${e.dataset.name}</span></label>\n                                 <label class="fs-18px font-ehsan-semibold">${t} من الذبائح</label>\n                                 </div>\n                                 <hr class="border mx-3 my-1"/>`)})),a}function D(e){p.disabled=e,q.disabled=e,e?(p.classList.remove("btn","btn-gradient"),p.classList.add("text-primary-green","font-semibold","border","bg-white"),p.innerHTML='<span class="pe-2">جاري توجيهك للدفع</span> <i class="fas fa-spinner fa-spin" aria-hidden=true></i>',t.innerText="جاري توجيهك للدفع"):(p.innerHTML="المتابعة للدفع",p.classList.add("btn","btn-gradient"),p.classList.remove("text-primary-green","font-semibold","border","bg-white")),p.focus()}l.addEventListener("show.bs.modal",(e=>{if(A.innerHTML=R(),i&&s)y.forEach((e=>{e.value="",e.classList.remove("border-primary-green","border-2","field-validation-valid")})),E=1,i.style.display="block",l.setAttribute("aria-label","رقم الجوال"),l.setAttribute("aria-describedby","mobile-number-tip"),document.querySelector("#divOtp .field-validation-valid").innerHTML="";else switch(E){case 1:document.querySelector('input[name="txtMobile"]').focus();break;case 2:document.getElementById("code1").focus();break;case 3:document.getElementById("step2").focus()}})),g.forEach((e=>{let t=0;e.addEventListener("click",(function(e){let a=this.closest(".adahi-increase-decrease").querySelector(".prodQuantity"),i=this.closest(".adahi-increase-decrease").querySelector(".decrease-adahi"),n=this.closest(".accordion-adahi").querySelector(".type-amount"),s=this.dataset.ritualid,l=this.dataset.id,d=this.dataset.key,r=this.dataset.name,o=document.getElementById(d+"-sr");const c=I.adahiRequestDetails.findIndex((e=>e.Key===d));n.textContent=Number(n.textContent)+Number(this.dataset.increase),n.parentElement.classList.add("text-primary"),-1!==c?(I.adahiRequestDetails[c].Quantity+=t,a.value=I.adahiRequestDetails[c].Quantity,o.innerText=`الكمية: ${I.adahiRequestDetails[c].Quantity} ${r}`):(t=1,i.disabled=!1,a.value=t,I.adahiRequestDetails.push({Key:d,RitualId:s,ProductId:l,Quantity:t,Price:Number(this.dataset.increase)}),o.innerText=`الكمية: ${t} ${r}`),x.textContent=L(I.adahiRequestDetails),f.textContent=B(I.adahiRequestDetails)}))})),S.forEach((e=>{e.addEventListener("click",(function(e){let t=this.closest(".adahi-increase-decrease").querySelector(".prodQuantity"),a=this.closest(".accordion-adahi").querySelector(".type-amount"),i=this.dataset.key,n=this.dataset.name,s=document.getElementById(i+"-sr");const l=I.adahiRequestDetails.findIndex((e=>e.Key===i));-1!==l&&(t.value=Number(t.value)-1,a.textContent=Number(a.textContent)-Number(this.dataset.decrease),I.adahiRequestDetails[l].Quantity-=1,s.innerText=`الكمية: ${I.adahiRequestDetails[l].Quantity} ${n}`,0==I.adahiRequestDetails[l].Quantity&&(I.adahiRequestDetails.splice(l,1),a.parentElement.classList.remove("text-primary"),this.disabled=!0),x.textContent=L(I.adahiRequestDetails),f.textContent=B(I.adahiRequestDetails))}))})),d.addEventListener("click",(function(e){I.adahiRequestDetails=[],L(I.adahiRequestDetails),m.forEach((e=>{e.innerText=0})),r.forEach((e=>e.value=0)),x.textContent=0,f.textContent=0,A.innerHTML=R(),I.adahiRequestDetails=[],t.innerText="تم حذف جميع الذبائح",document.querySelectorAll('span[id$="-sr"]').forEach((e=>e.innerText="")),S.forEach((e=>{e.disabled=!0}))})),null==h||h.addEventListener("click",(function(e){if(I.adahiRequestDetails.filter((e=>0!=e.Quantity)).length>0&&I.Mobile){let e="";document.querySelector(".verification-inputs").querySelectorAll(".otp").forEach((t=>e+=t.value)),""!==e&&6===e.length&&fetch(`Adahi/ValidateOtp/${I.Mobile}/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},async:!1}).then((e=>e.json())).then((e=>{if(e.isSuccess){document.getElementById("step2").classList.remove("d-none"),E=3,l.setAttribute("aria-label","ملخص الطلب"),l.setAttribute("aria-describedby","summary"),s.classList.add("d-none"),document.getElementById("stepsBar")}else{const t=e.result||"حدث خطأ أثناء إرسال الرسالة";s.querySelector(".field-validation-valid").classList.remove("d-none"),s.querySelector(".field-validation-valid").textContent=t}})).catch((e=>{s.querySelector(".field-validation-valid").classList.remove("d-none"),s.querySelector(".field-validation-valid").textContent="حدث خطأ أثناء التحقق من الرمز"}))}})),b.addEventListener("click",(async function(e){if(this.setAttribute("aria-disabled","true"),D(!0),I.adahiRequestDetails.filter((e=>0!==e.Quantity)).length>0){document.querySelectorAll(".Pay").forEach((e=>{e.setAttribute("disabled",!0)}));try{const e=await fetch("Adahi/Pay",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(I)}),t=await e.json();t.isSuccess?window.location.href=`Payment/Index?transactionId=${t.result}`:(D(!1),document.querySelectorAll(".Pay").forEach((e=>{e.removeAttribute("disabled")})),alert("حدث خطأ في عملية الدفع"))}catch(t){D(!1),document.querySelectorAll(".Pay").forEach((e=>{e.removeAttribute("disabled")})),alert("حدث خطأ في عملية الدفع")}}else alert("اختر ذبيحة واحدة على الأقل");this.setAttribute("aria-disabled","false")}));
//# sourceMappingURL=adahi.js.map
